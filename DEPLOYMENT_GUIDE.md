# 🚀 AI Escape Room - Cloud Deployment Guide

## 📋 Overview
This guide covers deploying your AI Escape Room to multiple cloud platforms including Railway, Heroku, DigitalOcean, AWS, and Vercel.

## ⚡ Quick Start - Deploy Now!

**Fastest Option**: Deploy with SQLite (your current working setup)

### Railway (30 seconds):
```bash
npm install -g @railway/cli
railway login
railway init
railway up
```
Then set these environment variables in Railway dashboard:
- `OPENAI_API_KEY=your_key`
- `SECRET_KEY=your_secret`
- `USE_POSTGRESQL=false`

**Done!** Your app will be live at the Railway URL.

## 🛠️ Prerequisites

### Required Files Created:
- ✅ `requirements.txt` - Python dependencies
- ✅ `Dockerfile` - Container configuration
- ✅ `docker-compose.yml` - Local development
- ✅ `.env.production` - Production environment template
- ✅ Health check endpoint at `/health`

### Current Database Status:
- ✅ **SQLite**: Working perfectly locally
- ❌ **PostgreSQL**: Permission issues (will fix for production)
- 🔄 **Deployment**: Can use either SQLite or PostgreSQL

### Environment Variables Options:

#### Option 1: SQLite (Simpler for first deployment)
```bash
OPENAI_API_KEY=your_openai_api_key_here
SECRET_KEY=your_super_secret_key_here
USE_POSTGRESQL=false
# No DATABASE_URL needed
```

#### Option 2: PostgreSQL (Recommended for production)
```bash
OPENAI_API_KEY=your_openai_api_key_here
SECRET_KEY=your_super_secret_key_here
USE_POSTGRESQL=true
DATABASE_URL=postgresql://username:password@host:port/database
```

---

## 🚂 Railway (Recommended - Easiest)

Railway is perfect for full-stack apps. You can start with SQLite and upgrade to PostgreSQL later.

### Option A: Deploy with SQLite (Fastest)

1. **Sign up**: Go to [railway.app](https://railway.app)
2. **Connect GitHub**: Link your repository
3. **Deploy**:
   ```bash
   # Install Railway CLI
   npm install -g @railway/cli

   # Login
   railway login

   # Initialize project
   railway init

   # Deploy (no database needed)
   railway up
   ```

4. **Set Environment Variables** in Railway dashboard:
   - `OPENAI_API_KEY=your_key_here`
   - `SECRET_KEY=your_secret_key`
   - `USE_POSTGRESQL=false`

### Option B: Deploy with PostgreSQL (Production-Ready)

1. **Follow steps 1-3 above**
2. **Add PostgreSQL**:
   ```bash
   # Add PostgreSQL database
   railway add postgresql
   ```

3. **Set Environment Variables** in Railway dashboard:
   - `OPENAI_API_KEY=your_key_here`
   - `SECRET_KEY=your_secret_key`
   - `USE_POSTGRESQL=true`
   - `DATABASE_URL` (auto-generated by Railway)

### Railway Features:
- ✅ Works with both SQLite and PostgreSQL
- ✅ Zero-config deployment
- ✅ Custom domains
- ✅ Automatic HTTPS
- ✅ Built-in monitoring
- ✅ Persistent storage for SQLite

---

## 🟣 Heroku

### Steps:
1. **Install Heroku CLI**
2. **Create Heroku app**:
   ```bash
   heroku create ai-escape-room-app

   # Add PostgreSQL
   heroku addons:create heroku-postgresql:essential-0

   # Set environment variables
   heroku config:set OPENAI_API_KEY=your_key_here
   heroku config:set SECRET_KEY=your_secret_key
   heroku config:set USE_POSTGRESQL=true

   # Deploy
   git push heroku main
   ```

3. **Create `Procfile`**:
   ```bash
   echo "web: uvicorn main:app --host 0.0.0.0 --port \$PORT" > Procfile
   ```

### Heroku Features:
- ✅ Managed PostgreSQL
- ✅ Easy scaling
- ✅ Add-ons marketplace
- ❌ More expensive than alternatives

---

## 🌊 DigitalOcean App Platform

### Steps:
1. **Create DigitalOcean account**
2. **Go to App Platform**
3. **Connect GitHub repository**
4. **Configure**:
   - Runtime: Python
   - Build Command: `pip install -r requirements.txt`
   - Run Command: `uvicorn main:app --host 0.0.0.0 --port 8080`
   - Port: 8080

5. **Add Database**: DigitalOcean Managed PostgreSQL
6. **Set Environment Variables** in dashboard

### DigitalOcean Features:
- ✅ Predictable pricing
- ✅ Managed databases
- ✅ Built-in CDN
- ✅ Custom domains

---

## ☁️ AWS (Advanced)

### Option 1: AWS App Runner (Easiest)
```bash
# Create apprunner.yaml
cat > apprunner.yaml << EOF
version: 1.0
runtime: python3
build:
  commands:
    build:
      - pip install -r requirements.txt
run:
  runtime-version: 3.11
  command: uvicorn main:app --host 0.0.0.0 --port 8000
  network:
    port: 8000
    env: PORT
  env:
    - name: USE_POSTGRESQL
      value: "true"
EOF
```

### Option 2: ECS with Fargate
```yaml
# Create task definition
{
  "family": "ai-escape-room",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "256",
  "memory": "512",
  "executionRoleArn": "arn:aws:iam::ACCOUNT:role/ecsTaskExecutionRole",
  "containerDefinitions": [
    {
      "name": "ai-escape-room",
      "image": "your-ecr-repo/ai-escape-room:latest",
      "portMappings": [
        {
          "containerPort": 8000,
          "protocol": "tcp"
        }
      ],
      "environment": [
        {"name": "USE_POSTGRESQL", "value": "true"}
      ],
      "secrets": [
        {"name": "OPENAI_API_KEY", "valueFrom": "arn:aws:ssm:region:account:parameter/openai-key"},
        {"name": "DATABASE_URL", "valueFrom": "arn:aws:ssm:region:account:parameter/db-url"}
      ]
    }
  ]
}
```

### AWS Features:
- ✅ Enterprise-grade
- ✅ Highly scalable
- ✅ Many integrations
- ❌ Complex setup
- ❌ Higher learning curve

---

## ⚡ Vercel + Supabase (Frontend/Backend Split)

### Backend on Railway, Frontend on Vercel:

1. **Deploy Backend to Railway** (see Railway section)

2. **Build React App**:
   ```bash
   cd ui
   npm run build
   ```

3. **Deploy to Vercel**:
   ```bash
   npm install -g vercel
   cd ui
   vercel --prod
   ```

4. **Configure Environment**:
   ```bash
   # In Vercel dashboard, set:
   VITE_API_URL=https://your-railway-app.railway.app
   ```

### Vercel Features:
- ✅ Excellent for React apps
- ✅ Global CDN
- ✅ Custom domains
- ✅ Automatic deployments

---

## 🐳 Docker Deployment (Any Cloud)

### Build and Push:
```bash
# Build Docker image
docker build -t ai-escape-room .

# Tag for registry
docker tag ai-escape-room your-registry/ai-escape-room:latest

# Push to registry
docker push your-registry/ai-escape-room:latest
```

### Deploy with Docker Compose:
```bash
# On your server
docker-compose up -d
```

---

## 🗄️ Database Options

### 1. **Railway PostgreSQL** (Recommended)
- Automatic setup
- Managed backups
- Built-in monitoring

### 2. **Supabase** (PostgreSQL + Auth)
```bash
# Environment variables
DATABASE_URL=postgresql://postgres:password@db.supabase.co:5432/postgres
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
```

### 3. **PlanetScale** (MySQL)
```bash
DATABASE_URL=mysql://username:password@hostname:port/database
```

### 4. **AWS RDS**
```bash
DATABASE_URL=postgresql://username:password@instance.region.rds.amazonaws.com:5432/database
```

---

## 🔒 Security Checklist

### Environment Variables:
- [ ] Strong SECRET_KEY (64+ characters)
- [ ] Valid OPENAI_API_KEY
- [ ] Secure DATABASE_URL
- [ ] CORS origins set for production domain

### Production Settings:
```python
# Update main.py for production
import os

# Dynamic CORS origins
allowed_origins = os.getenv("ALLOWED_ORIGINS", "").split(",") if os.getenv("ALLOWED_ORIGINS") else ["*"]

app.add_middleware(
    CORSMiddleware,
    allow_origins=allowed_origins,
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)
```

### Database Security:
- [ ] Use connection pooling
- [ ] Enable SSL/TLS
- [ ] Regular backups
- [ ] Monitor for suspicious activity

---

## 📊 Monitoring & Performance

### Essential Endpoints:
- `/health` - Health check
- `/docs` - API documentation
- `/metrics` - Application metrics (if implemented)

### Recommended Monitoring:
- **Uptime**: UptimeRobot, Pingdom
- **Performance**: New Relic, DataDog
- **Logs**: LogRocket, Sentry
- **Database**: Built-in cloud monitoring

---

## 🚀 Quick Deploy Commands

### Railway (Fastest):
```bash
npm install -g @railway/cli
railway login
railway init
railway add postgresql
railway up
```

### Heroku:
```bash
heroku create your-app-name
heroku addons:create heroku-postgresql:essential-0
git push heroku main
```

### DigitalOcean:
```bash
# Use web interface - connect GitHub repo
# Add managed PostgreSQL database
# Deploy with one click
```

---

## 🎯 Recommended Setup for Your AI Escape Room

**Best Option**: **Railway**
- ✅ Automatic PostgreSQL
- ✅ Zero configuration
- ✅ Affordable pricing
- ✅ Great for indie projects

**Enterprise Option**: **AWS ECS + RDS**
- ✅ Enterprise-grade
- ✅ Highly scalable
- ✅ Full control

**Budget Option**: **Heroku**
- ✅ Simple deployment
- ✅ Good documentation
- ❌ More expensive

---

## 🔧 Troubleshooting

### Common Issues:

1. **Environment Variables Not Loading**:
   ```python
   # Add to main.py
   from dotenv import load_dotenv
   load_dotenv()
   ```

2. **Database Connection Fails**:
   - Check DATABASE_URL format
   - Verify database is running
   - Test connection with psql

3. **CORS Errors**:
   - Add your domain to allowed_origins
   - Check protocol (http vs https)

4. **OpenAI API Errors**:
   - Verify API key is valid
   - Check rate limits
   - Monitor usage

### Debug Commands:
```bash
# Check health endpoint
curl https://your-app.com/health

# View logs
railway logs  # Railway
heroku logs --tail  # Heroku

# Test database
psql $DATABASE_URL
```

---

## 📱 Frontend Deployment

### Build React App:
```bash
cd ui
npm run build
```

### Deploy Options:
1. **Serve from FastAPI** (current setup)
2. **Separate Vercel deployment** (recommended)
3. **CDN deployment** (advanced)

---

Your AI Escape Room is now ready for cloud deployment! 🎮☁️

Choose your preferred platform and follow the respective guide. Railway is recommended for beginners, while AWS is better for enterprise use cases.